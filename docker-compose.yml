
services:
  nostremail:
    build: .
    container_name: nostremail-app
    restart: unless-stopped
    env_file:
      - .env
    environment:
      - MONGO_URI=${MONGODB_URI}
      - MONGO_DB=${MONGODB_DATABASE}
      - NOSTREMAIL_SENDER_NPUB=${NOSTREMAIL_SENDER_NPUB}
      - NOSTREMAIL_SENDER_NSEC=${NOSTREMAIL_SENDER_NSEC}
      - NOSTREMAIL_SENDER_EMAIL=${NOSTREMAIL_SENDER_EMAIL}
      - NOSTREMAIL_RELAYS=${NOSTREMAIL_RELAYS}
      - NOSTREMAIL_SMTP_HOST=${NOSTREMAIL_SMTP_HOST}
      - NOSTREMAIL_SMTP_PORT=${NOSTREMAIL_SMTP_PORT}
      - NOSTREMAIL_SMTP_USERNAME=${NOSTREMAIL_SMTP_USERNAME}
      - NOSTREMAIL_SMTP_PASSWORD=${NOSTREMAIL_SMTP_PASSWORD}
      - NOSTREMAIL_SMTP_FROM_NAME=${NOSTREMAIL_SMTP_FROM_NAME}
    volumes:
      - ./config.json:/root/config.json:ro
      - nostremail_data:/data
      - ./processed_notes.db:/root/processed_notes.db
    extra_hosts:
      - "host.docker.internal:host-gateway"
    command: ["./nostremail", "--nostr-listen"]

volumes:
  nostremail_data:
    driver: local